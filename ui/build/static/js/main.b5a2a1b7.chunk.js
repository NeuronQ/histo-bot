(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{327:function(e,t,a){},396:function(e,t,a){e.exports=a(757)},53:function(e,t,a){e.exports={item:"ResultThumbs_item__3gCMN",mask:"ResultThumbs_mask__21M_S",img:"ResultThumbs_img__1ieaa",score:"ResultThumbs_score__33FCe",ZoomDialogContainer:"ResultThumbs_ZoomDialogContainer__3eb2h",ZoomDialogImg:"ResultThumbs_ZoomDialogImg__21Fkx",ZoomDialogThumb:"ResultThumbs_ZoomDialogThumb__1nug2"}},754:function(e,t,a){},755:function(e,t,a){},757:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"withStyles",function(){return E.withStyles}),a.d(n,"CssBaseline",function(){return _.a}),a.d(n,"Avatar",function(){return D.a}),a.d(n,"Divider",function(){return w.a}),a.d(n,"Drawer",function(){return k.a}),a.d(n,"Fab",function(){return x.a}),a.d(n,"Tabs",function(){return A.a}),a.d(n,"Tab",function(){return N.a}),a.d(n,"Paper",function(){return P.a}),a.d(n,"Grid",function(){return R.a}),a.d(n,"Button",function(){return M.a}),a.d(n,"IconButton",function(){return z.a}),a.d(n,"Typography",function(){return W.a}),a.d(n,"Toolbar",function(){return V.a}),a.d(n,"TabContainer",function(){return V.a}),a.d(n,"AppBar",function(){return X.a}),a.d(n,"Table",function(){return Y.a}),a.d(n,"TableBody",function(){return $.a}),a.d(n,"TableCell",function(){return K.a}),a.d(n,"TableHead",function(){return te.a}),a.d(n,"TableRow",function(){return ne.a}),a.d(n,"DialogTitle",function(){return ie.a}),a.d(n,"DialogContent",function(){return le.a}),a.d(n,"Dialog",function(){return ce.a}),a.d(n,"List",function(){return me.a}),a.d(n,"ListItem",function(){return ge.a}),a.d(n,"ListItemIcon",function(){return fe.a}),a.d(n,"ListItemText",function(){return be.a}),a.d(n,"Card",function(){return Ee.a}),a.d(n,"CardActions",function(){return _e.a}),a.d(n,"CardContent",function(){return De.a}),a.d(n,"CardHeader",function(){return we.a}),a.d(n,"LinearProgress",function(){return ke.a}),a.d(n,"CircularProgress",function(){return xe.a}),a.d(n,"GridList",function(){return Ae.a}),a.d(n,"GridListTile",function(){return Ne.a}),a.d(n,"Switch",function(){return Pe.a}),a.d(n,"TextField",function(){return Re.a}),a.d(n,"Menu",function(){return Me.a}),a.d(n,"MenuList",function(){return ze.a}),a.d(n,"MenuItem",function(){return We.a}),a.d(n,"Icon",function(){return Ve.a}),a.d(n,"red",function(){return Xe.a}),a.d(n,"pink",function(){return Ye.a}),a.d(n,"purple",function(){return $e.a}),a.d(n,"deepPurple",function(){return Ke.a}),a.d(n,"indigo",function(){return tt.a}),a.d(n,"blue",function(){return nt.a}),a.d(n,"lightBlue",function(){return it.a}),a.d(n,"cyan",function(){return lt.a}),a.d(n,"teal",function(){return ct.a}),a.d(n,"green",function(){return mt.a}),a.d(n,"lightGreen",function(){return gt.a}),a.d(n,"yellow",function(){return ft.a}),a.d(n,"amber",function(){return bt.a}),a.d(n,"orange",function(){return Et.a}),a.d(n,"deepOrange",function(){return _t.a}),a.d(n,"brown",function(){return Dt.a}),a.d(n,"grey",function(){return wt.a}),a.d(n,"blueGrey",function(){return kt.a});var r={};a.r(r),a.d(r,"asSet",function(){return sa}),a.d(r,"xset",function(){return ca}),a.d(r,"xmap",function(){return ua}),a.d(r,"xomap",function(){return ma}),a.d(r,"getFileContents",function(){return da}),a.d(r,"augmentWithStateFieldArrayMethods",function(){return ga}),a.d(r,"base64_to_blob",function(){return pa});var i=a(0),o=a.n(i),l=a(33),s=a.n(l),c=a(26),u=a(17),m=a(19),d=a(22),g=a(20),p=a(21),f=a(770),h=a(771),b=a(29),v=a.n(b),E=a(43),y=a(107),_=a.n(y),S=a(108),D=a.n(S),O=a(109),w=a.n(O),C=a(110),k=a.n(C),j=a(114),x=a.n(j),T=a(115),A=a.n(T),I=a(116),N=a.n(I),L=a(48),P=a.n(L),B=a(117),R=a.n(B),F=a(86),M=a.n(F),U=a(87),z=a.n(U),H=a(58),W=a.n(H),G=a(71),V=a.n(G),Z=a(118),X=a.n(Z),q=a(119),Y=a.n(q),J=a(120),$=a.n(J),Q=a(122),K=a.n(Q),ee=a(123),te=a.n(ee),ae=a(124),ne=a.n(ae),re=a(125),ie=a.n(re),oe=a(126),le=a.n(oe),se=a(127),ce=a.n(se),ue=a(88),me=a.n(ue),de=a(89),ge=a.n(de),pe=a(128),fe=a.n(pe),he=a(129),be=a.n(he),ve=a(130),Ee=a.n(ve),ye=a(131),_e=a.n(ye),Se=a(132),De=a.n(Se),Oe=a(133),we=a.n(Oe),Ce=a(134),ke=a.n(Ce),je=a(135),xe=a.n(je),Te=a(136),Ae=a.n(Te),Ie=a(137),Ne=a.n(Ie),Le=a(138),Pe=a.n(Le),Be=a(139),Re=a.n(Be),Fe=a(140),Me=a.n(Fe),Ue=a(92),ze=a.n(Ue),He=a(141),We=a.n(He),Ge=a(142),Ve=a.n(Ge),Ze=a(176),Xe=a.n(Ze),qe=a(174),Ye=a.n(qe),Je=a(257),$e=a.n(Je),Qe=a(258),Ke=a.n(Qe),et=a(173),tt=a.n(et),at=a(259),nt=a.n(at),rt=a(260),it=a.n(rt),ot=a(261),lt=a.n(ot),st=a(262),ct=a.n(st),ut=a(263),mt=a.n(ut),dt=a(264),gt=a.n(dt),pt=a(265),ft=a.n(pt),ht=a(266),bt=a.n(ht),vt=a(267),Et=a.n(vt),yt=a(268),_t=a.n(yt),St=a(269),Dt=a.n(St),Ot=a(175),wt=a.n(Ot),Ct=a(270),kt=a.n(Ct),jt=a(763),xt=a(5),Tt=a.n(xt),At=a(767),It=a(768),Nt=a(764),Lt=a(327),Pt=a.n(Lt),Bt=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:Tt()("Page",Pt.a.Page)},o.a.createElement(P.a,{square:!0},o.a.createElement(At.a,{style:{width:"100%",textAlign:"center",border:0,boxShadow:"none"}},o.a.createElement(It.a,{columns:2,relaxed:"very",stackable:!0},o.a.createElement(It.a.Column,null,o.a.createElement(jt.a,{to:"/models"},o.a.createElement(M.a,{variant:"contained",color:"primary"},"Models"))),o.a.createElement(It.a.Column,{verticalAlign:"middle"},o.a.createElement(jt.a,{to:"/analyses"},o.a.createElement(M.a,{variant:"contained",color:"primary"},"Analyses")))),o.a.createElement(Nt.a,{vertical:!0},"\u2228"))))}}]),t}(i.Component),Rt=a(332),Ft=a(224),Mt=a(36),Ut=a(63);function zt(e){var t,a;if(":"===e[0]){var r=e.slice(1).split("|"),i=Object(Mt.a)(r,2),o=i[0],l=i[1],s=o.split("."),c=Object(Mt.a)(s,2),u=c[0],m=c[1];if(t=n[u][m||500],l){var d=l.split("."),g=Object(Mt.a)(d,2),p=g[0],f=g[1];a=n[p][f]}else a=n[u][+(m||500)+200]}else{var h=e.split("|"),b=Object(Mt.a)(h,2);t=b[0],a=b[1]}return[t,a]}var Ht=function(e){var t,a,n=e.color,r=e.textColor,i=e.icon,l=e.iconRight,s=e.children,u=e.linkTo,m=e.loading,d=Object(Ft.a)(e,["color","textColor","icon","iconRight","children","linkTo","loading"]),g={"&:hover":{}};if(n)if(-1!==["default","inherit","primary","secondary"].indexOf(n))d.color=n;else{var p=zt(n),f=Object(Mt.a)(p,2),h=f[0],b=f[1],v="contained"===d.variant?"backgroundColor":"borderColor";g[v]=h,b&&(g["&:hover"][v]=b)}if(r){var y=zt(r),_=Object(Mt.a)(y,2),S=_[0],D=_[1];g.color=S,D&&(g["&:hover"].color=D)}if(i&&(t=0===i.indexOf("sui.")?o.a.createElement(Ut.a,{name:i.slice(4),style:{marginTop:"-9px"}}):0===i.indexOf("fa-")?o.a.createElement(Ve.a,{className:"fas ".concat(i),style:{fontSize:"1.1rem",width:"1.5em",marginRight:3}}):o.a.createElement(o.a.Fragment,null,o.a.createElement(Ve.a,null,i),"\xa0")),m){d.disabled=!0;var O=E.withStyles(function(e){return{root:{marginRight:6}}})(function(e){return o.a.createElement(xe.a,Object.assign({className:e.classes.root},e))});a=o.a.createElement(O,{size:18})}var w=E.withStyles(function(e){return{root:Object(c.a)({},g,{color:g.color||(g.backgroundColor?e.palette.getContrastText(g.backgroundColor):void 0)})}})(function(e){return o.a.createElement(M.a,Object.assign({className:"".concat(e.classes.root," ").concat(e.className||"")},Object(c.a)({},d,e)))}),C=o.a.createElement(w,null,!l&&(m?a:i&&t),s,l&&(m?a:i&&t));return u?o.a.createElement(jt.a,{to:u},C):C},Wt=E.withStyles(function(e){return{root:Object(c.a)({},e.mixins.gutters(),{paddingTop:2*e.spacing.unit,paddingBottom:2*e.spacing.unit})}})(P.a),Gt=E.withStyles(function(e){return{dialogTitle:{borderBottom:"1px solid ".concat(e.palette.divider),margin:0,padding:2*e.spacing.unit,paddingRight:55},closeButton:{position:"absolute",right:2,top:4,color:e.palette.grey[500]}}})(function(e){var t=e.classes,a=e.onClose,n=e.title,r=e.items,i=e.renderItem,l=Object(Ft.a)(e,["classes","onClose","title","items","renderItem"]);return o.a.createElement(ce.a,Object.assign({onClose:function(){return a(null)},"aria-labelledby":"simple-dialog-title",className:t.root},l),o.a.createElement(ie.a,{id:"simple-dialog-title",className:t.dialogTitle},n,o.a.createElement(z.a,{"aria-label":"Close",className:t.closeButton,onClick:function(){return a(null)}},o.a.createElement(Ve.a,null,"close"))),o.a.createElement(me.a,null,r.map(i)))}),Vt=a(53),Zt=a.n(Vt),Xt=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={zoomDialogOpen:!1,zoomedImage:null,zoomDialogShowSegmentation:!1},a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props.items,a=this.state.zoomedImage;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:Zt.a.root},t.map(function(t,a){return o.a.createElement("div",{key:100*t.id+a,className:Zt.a.item,onClick:function(){return e.setState({zoomedImage:t,zoomDialogOpen:!0,zoomDialogShowSegmentation:!0})}},o.a.createElement("img",{src:t.imgThumbSrc,alt:t.id,className:Zt.a.img}),o.a.createElement("img",{src:t.maskThumbSrc,alt:t.id,className:Zt.a.mask}),o.a.createElement("div",{className:Zt.a.score},o.a.createElement("code",null,t.score)))})),this.state.zoomDialogOpen&&this.state.zoomedImage&&o.a.createElement(ce.a,{fullScreen:!0,open:this.state.zoomDialogOpen,onClose:function(){return e.setState({zoomDialogOpen:!1})}},o.a.createElement(X.a,null,o.a.createElement(V.a,null,o.a.createElement("div",{style:{flexGrow:1}},a.id," -"," ",o.a.createElement("strong",null,a.imgThumbSrc.split("/").slice(-1)[0]),"\xa0\xa0\xa0\xa0\xa0\xa0 Show segmentation:",o.a.createElement(Pe.a,{checked:this.state.zoomDialogShowSegmentation,onChange:function(t,a){return e.setState({zoomDialogShowSegmentation:a})},"aria-label":"ShowLabels"})),o.a.createElement(z.a,{color:"inherit",onClick:function(){return e.setState({zoomDialogOpen:!1})},"aria-label":"Close"},o.a.createElement(Ve.a,null,"close")))),o.a.createElement("div",{className:Zt.a.ZoomDialogContainer},o.a.createElement("img",{className:Zt.a.ZoomDialogImg,src:a.imgSrc,alt:""}),this.state.zoomDialogShowSegmentation&&o.a.createElement("img",{className:Zt.a.ZoomDialogThumb,src:a.maskSrc,alt:""}))))}}]),t}(i.Component),qt=function(e){return Ht(Object(c.a)({},e,{color:":blue",size:"small",variant:"contained",icon:"fa-cogs"}))},Yt=function(e){return Ht(Object(c.a)({},e,{color:":red",textColor:":red",size:"small",icon:"delete_forever"}))},Jt=0;function $t(e,t,a,n){return{id:Jt+=1,name:e,architecture:t,trained_at:a,trained_by:n}}var Qt=[$t("Segmenter XYZ","ResNet34-UNet",new Date,"Diana M."),$t("Nuclei segm-fg3","ResNet50-UNet",new Date,"Marie Q."),$t("Test v10","ResNet34-UNet",new Date,"Pierre F.")],Kt=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={newModelArchDialogOpen:!1},a.handleNewModelArchDialogClose=function(e){a.setState({newModelArchDialogOpen:!1}),e&&a.props.history.push("/models/new/step-1-data?arch="+e)},a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"Page PageModels"},o.a.createElement(P.a,{square:!0,style:{paddingBottom:"16px"}},o.a.createElement(Y.a,null,o.a.createElement(te.a,null,o.a.createElement(ne.a,null,o.a.createElement(K.a,null,"Name"),o.a.createElement(K.a,null,"Architecture"),o.a.createElement(K.a,null,"Trained"),o.a.createElement(K.a,null,"By"),o.a.createElement(K.a,null))),o.a.createElement($.a,null,Qt.map(function(e){return o.a.createElement(ne.a,{key:e.id},o.a.createElement(K.a,null,e.name),o.a.createElement(K.a,null,e.architecture),o.a.createElement(K.a,null,e.trained_at.toLocaleString()),o.a.createElement(K.a,null,e.trained_by),o.a.createElement(K.a,null,o.a.createElement(Yt,null,"Delete"),"\xa0\xa0\xa0",o.a.createElement(qt,null,"Train")))}))),o.a.createElement("br",null),o.a.createElement(Rt.a,{align:"center"},o.a.createElement(jt.a,{to:"/models/new"},o.a.createElement(M.a,{variant:"contained",color:"primary",onClick:function(){return e.setState({newModelArchDialogOpen:!0})}},"Create New Model")))))}}]),t}(i.Component),ea=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"Page PageAnalyses"},o.a.createElement(Wt,null,o.a.createElement("code",null,"[ list of analyses ]")))}}]),t}(i.Component),ta=a(27),aa=a.n(ta),na=a(38),ra=a(47),ia=a(167),oa=a.n(ia),la=a(766),sa=function(e){return e instanceof Set?e:new Set(e)},ca=function(){function e(){Object(u.a)(this,e)}return Object(m.a)(e,null,[{key:"isSuperset",value:function(e,t){e=sa(e),t=sa(t);var a=!0,n=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(a=(i=o.next()).done);a=!0){var l=i.value;if(!e.has(l))return!1}}catch(s){n=!0,r=s}finally{try{a||null==o.return||o.return()}finally{if(n)throw r}}return!0}},{key:"union",value:function(e,t){e=sa(e),t=sa(t);var a=new Set(e),n=!0,r=!1,i=void 0;try{for(var o,l=t[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var s=o.value;a.add(s)}}catch(c){r=!0,i=c}finally{try{n||null==l.return||l.return()}finally{if(r)throw i}}return a}},{key:"intersection",value:function(e,t){e=sa(e),t=sa(t);var a=new Set,n=!0,r=!1,i=void 0;try{for(var o,l=t[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var s=o.value;e.has(s)&&a.add(s)}}catch(c){r=!0,i=c}finally{try{n||null==l.return||l.return()}finally{if(r)throw i}}return a}},{key:"symmetricDifference",value:function(e,t){e=sa(e),t=sa(t);var a=new Set(e),n=!0,r=!1,i=void 0;try{for(var o,l=t[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var s=o.value;a.has(s)?a.delete(s):a.add(s)}}catch(c){r=!0,i=c}finally{try{n||null==l.return||l.return()}finally{if(r)throw i}}return a}},{key:"difference",value:function(e,t){e=sa(e),t=sa(t);var a=new Set(e),n=!0,r=!1,i=void 0;try{for(var o,l=t[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var s=o.value;a.delete(s)}}catch(c){r=!0,i=c}finally{try{n||null==l.return||l.return()}finally{if(r)throw i}}return a}}]),e}(),ua=function(e){for(var t,a=arguments.length,n=new Array(a>1?a-1:0),r=1;r<a;r++)n[r-1]=arguments[r];return e.map?e.map.apply(e,n):(t=Array.from(e)).map.apply(t,n)},ma=function(e){for(var t,a=arguments.length,n=new Array(a>1?a-1:0),r=1;r<a;r++)n[r-1]=arguments[r];if(e.entries){var i,o=e.entries();return o.map?o.map.apply(o,n):(i=Array.from(o)).map.apply(i,n)}return(t=Object.entries(e)).map.apply(t,n)},da=function(e){var t=new FileReader;return new Promise(function(a,n){t.onload=function(e){console.log("read file: ev.target.result"),a(e.target.result)},t.onerror=function(e){t.abort(),n(e)},t.readAsBinaryString(e)})},ga=function(e,t,a){e["add"+a]=function(a){return e.setState(function(e){return v.a.push(e,t,a)})},e["remove"+a]=function(a){return e.setState(function(e){return v.a.del(e,"".concat(t,".").concat(a))})},e["replace"+a]=function(a,n){return e.setState(function(e){return v.a.set(e,"".concat(t,".").concat(a),n)})},e["update"+a]=function(a,n){return e.setState(function(e){return v.a.merge(e,"".concat(t,".").concat(a),n)})}},pa=function(e){for(var t=e.split(/[:;,]/,4),a=Object(Mt.a)(t,4),n=(a[0],a[1]),r=(a[2],a[3]),i=atob(r),o=[],l=0,s=i.length;l<s;l++)o.push(i.charCodeAt(l));return new Blob([new Uint8Array(o)],{type:n})},fa=a(339),ha=a(333),ba=a.n(ha),va=Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_BASE_API_URL||"/api/v1",Ea={"Content-Type":"application/json"};Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_LOCAL_DEV_USER&&Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_LOCAL_DEV_PWD&&(Ea.Authorization="Basic ".concat(btoa(Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_LOCAL_DEV_USER+":"+Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_LOCAL_DEV_PWD)));var ya=ba.a.create({baseURL:va,headers:Ea,xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken",validateStatus:function(e){return 401!==e&&403!==e||-1!==window.location.host.indexOf(":")||(window.location.pathname="/accounts/login/"),e>=200&&e<400}});window._apiClient=ya;var _a=a(163),Sa=function(){function e(){Object(u.a)(this,e)}return Object(m.a)(e,null,[{key:"_withoutNullIds",value:function(e){return Object.keys(e).reduce(function(t,a){return a.match(/_id$/)&&null===e[a]?t:Object(c.a)({},t,Object(_a.a)({},a,e[a]))},{})}},{key:"fromApiData",value:function(e){for(var t=Object(c.a)({},e),a=Object.entries(this.defaultConversions),n=0;n<a.length;n++){var r=a[n],i=Object(Mt.a)(r,2),o=i[0],l=i[1];t[o]=l(t[o])}return t}},{key:"toApiData",value:function(e){for(var t={},a=Object.keys(e),n=0;n<a.length;n++){var r=a[n];this.readOnlyFields.has(r)||(this.skipUnderscorePrefixed&&"_"===r[0]||(t[r]=e[r]))}return t}}]),e}();Sa.defaultReadOnlyFields=new Set(["created_at","updated_at"]),Sa.defaultConversions={created_at:function(e){return new Date(e)},updated_at:function(e){return new Date(e)}},Sa.skipUnderscorePrefixed=!0;var Da=function(e){function t(e){var a,n;Object(u.a)(this,t);for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return n=Object(d.a)(this,(a=Object(g.a)(t)).call.apply(a,[this].concat(i))),Error.captureStackTrace&&Error.captureStackTrace(Object(ra.a)(Object(ra.a)(n)),t),n.message="API error (HTTP code ".concat(e.status,"): ").concat(n.message),n.response=e,n}return Object(p.a)(t,e),t}(Object(fa.a)(Error)),Oa=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,null,[{key:"getSelf",value:function(){return ya.get("/self/")}}]),t}(Sa);Oa.readOnlyFields=new Set(["email"]);var wa=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,null,[{key:"get",value:function(e){return ya.get("/models/".concat(e,"/"))}},{key:"update",value:function(e){return ya.patch("/models/".concat(e.id,"/"),this._withoutNullIds(e))}},{key:"create",value:function(e){return ya.post("/models/",e)}}]),t}(Sa),Ca=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,null,[{key:"fromApiData",value:function(e){var t=Sa.fromApiData(e);return t.datasetimages=t.datasetimages.map(function(e){return Sa.fromApiData(e)}),t}},{key:"list",value:function(){return ya.get("/datasets/")}},{key:"create",value:function(e){return ya.post("/datasets/",e)}}]),t}(Sa);Ca.readOnlyFields=ca.union(Sa.readOnlyFields,["datasetimages"]);var ka=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,null,[{key:"_makeFormData",value:function(e){for(var t=new FormData,a=Object.entries(e),n=0;n<a.length;n++){var r=a[n],i=Object(Mt.a)(r,2),o=i[0],l=i[1];"image"!==o&&t.append(o,l)}if(e.image.file_contents){var s=e.image.file_contents;"string"===typeof s&&"data:"===s.slice(0,5)&&(s=pa(s)),t.append("image",s,e.image.file_name||"_.png")}else e.image.file instanceof File&&t.append("image",e.image.file,e.image.file_name||e.image.file.name);return t}},{key:"create",value:function(e){var t=this._makeFormData(e);return ya.post(this.endpointUrl,t,{headers:{"content-type":"multipart/form-data"}})}},{key:"update",value:function(e){var t=this._makeFormData(e);return ya.patch("".concat(this.endpointUrl).concat(e.id,"/"),t,{headers:{"content-type":"multipart/form-data"}})}}]),t}(Sa),ja=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(p.a)(t,e),t}(ka);ja.endpointUrl="/images/";var xa=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(p.a)(t,e),t}(ka);xa.endpointUrl="/label-images/";var Ta=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,null,[{key:"get",value:function(e){return ya.get("/training-sessions/".concat(e,"/"))}},{key:"create",value:function(e){return ya.post("/training-sessions/",this._withoutNullIds(e))}}]),t}(Sa),Aa=function(){return Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_BASE_WS_URL?Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_BASE_WS_URL:("https:"===window.location.protocol?"wss:":"ws:")+"//"+window.location.host+"/ws"},Ia=a(765),Na=function(e){return Ht(Object(c.a)({size:"small",style:{marginTop:-8,marginRight:8}},e))},La=function(e){return Na(Object(c.a)({icon:"fa-times",children:"Remove"},e))},Pa=function(e){var t=e.dataset,a=e.datasetIdx,n=(e.removeTrainingDataset,e.updateTrainingDataset),r=e.removeTrainingDatasetImage,i=e.addTrainingDatasetImage,l=e.actions,s=e.imageActions;return o.a.createElement("div",null,o.a.createElement(Ee.a,{square:!0},o.a.createElement(we.a,{avatar:o.a.createElement(D.a,{"aria-label":"Recipe",style:{backgroundColor:ct.a[500]}},o.a.createElement(Ve.a,{className:"fas fa-database",style:{textAlign:"center",fontSize:"1.2rem"}})),action:o.a.createElement(o.a.Fragment,null,o.a.createElement("br",null),l),title:o.a.createElement(o.a.Fragment,null,"Dataset:"," ",t.id?o.a.createElement("code",null,t.created_at.toLocaleString()," - ",t.name):o.a.createElement(Ia.a,{value:t.name,onChange:function(e){return n({name:e.target.value})},style:{width:400}})),subheader:"".concat(t.datasetimages.length," images")})),o.a.createElement("div",null,t.datasetimages.map(function(e,n){return o.a.createElement(Ee.a,{key:"".concat(t.id,"-").concat(a,"-").concat(e.id,"-").concat(n),square:!0},o.a.createElement(we.a,{avatar:o.a.createElement(D.a,{style:{backgroundColor:$e.a[500]}},e.image_id?o.a.createElement("img",{src:e.image.summary.thumb,style:{width:"100%",height:"auto"},alt:""}):o.a.createElement(Ve.a,null,"image")),action:o.a.createElement(o.a.Fragment,null,o.a.createElement("br",null),s&&o.a.createElement("div",null,o.a.createElement("span",{style:{position:"relative",top:-4,marginRight:8}},s({datasetimage:e}))),("not uploaded"===e._status||"uploaded"===e._staus)&&o.a.createElement(La,{onClick:function(){return r(n)}}),"uploading"===e._status&&o.a.createElement("div",null,o.a.createElement("span",{style:{position:"relative",top:-4,marginRight:16}},"Uploading...",o.a.createElement(xe.a,{style:{width:20,height:20,marginLeft:16,position:"relative",top:4}}))),"upload failed"===e._status&&o.a.createElement("div",null,o.a.createElement("span",{style:{position:"relative",top:-4,marginRight:8,color:"red"}},"Upload failed!"),o.a.createElement(La,{onClick:function(){return r(n)},variant:"outlined"}))),title:e.image_id?e.image.name:o.a.createElement("label",{htmlFor:"input-dsi-image-".concat(t.id,"-").concat(a,"-").concat(e.id,"-").concat(n)},"Choose image to upload:"),subheader:e.image_id?"".concat(e.image.w,"\xd7").concat(e.image.h," px"):o.a.createElement("input",{type:"file",id:"input-dsi-image-".concat(t.id,"-").concat(a,"-").concat(e.id,"-").concat(n),ref:e._fileInput})}))}),!t.id&&o.a.createElement(Ee.a,{square:!0},o.a.createElement(we.a,{title:o.a.createElement(Ht,{onClick:function(){return i({_fileInput:o.a.createRef(),_status:"not uploaded"})},variant:"contained",color:":purple"},"Add Image")})),o.a.createElement("br",null)))},Ba=function(e){return function(e){return Ht(Object(c.a)({size:"small",style:{marginTop:-8,marginRight:8}},e))}(Object(c.a)({icon:"fa-times",children:"Remove"},e))},Ra=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={addDatasetDialogOpen:!1},a.handleSelectDataset=function(e){a.setState({addDatasetDialogOpen:!1}),e&&a.props.addTrainingDataset(e)},a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(R.a,{container:!0,spacing:16},o.a.createElement(R.a,{item:!0,xs:6},o.a.createElement(Ht,{children:"Select Dataset",onClick:function(){return e.setState({addDatasetDialogOpen:!0})},color:":teal",variant:"contained",icon:"fa-database",fullWidth:!0})),o.a.createElement(R.a,{item:!0,xs:6},o.a.createElement(Ht,{children:"New Dataset / Upload Image(s)",onClick:function(){return e.props.addTrainingDataset({name:"",datasetimages:[{_fileInput:o.a.createRef(),_status:"not uploaded"}]})},color:":purple",variant:"contained",icon:"cloud_upload",fullWidth:!0}))),o.a.createElement("br",null),this.props.trainingDatasets.map(function(t,a){return o.a.createElement(Pa,{key:"".concat(t.id,"-").concat(a),dataset:t,datasetIdx:a,removeDataset:function(){return e.props.removeTrainingDataset(a)},updateTrainingDataset:function(t){return e.props.updateTrainingDataset(a,t)},removeTrainingDatasetImage:function(t){return e.props.removeTrainingDatasetImage(a,t)},addTrainingDatasetImage:function(t){return e.props.addTrainingDatasetImage(a,t)},actions:o.a.createElement(Ba,{onClick:function(){return e.props.removeTrainingDataset(a)},variant:"outlined"})})}),o.a.createElement(Gt,{title:"Add dataset",open:this.state.addDatasetDialogOpen,onClose:function(){return e.handleSelectDataset(null)},items:Array.from(this.props.datasetsById.values()).filter(function(t){return!e.props.trainingDatasets.find(function(e){return e.id===t.id})}),renderItem:function(t){return o.a.createElement(ge.a,{button:!0,onClick:function(){return e.handleSelectDataset(e.props.datasetsById.get(t.id))},key:t.id},t.name)}}))}}]),t}(i.Component),Fa=a(758),Ma=function(){function e(t){var a=this,n=t.canvas,r=t.container,i=t.dx,o=t.dy,l=t.url,s=t.setDirty,c=t.getBrushMode,m=t.getBrushColor;Object(u.a)(this,e),this.removePixels=function(e,t){for(var n,r,i,o,l,s=a._cx.getImageData(0,0,a.canvas.width,a.canvas.height),c=s.data,u=0,m=c.length;u<m;u+=4){var d=[c[u],c[u+1],c[u+2],c[u+3]];if(n=d[0],r=d[1],i=d[2],255===d[3])if(n!==e[0]||r!==e[1]||i!==e[2]){l=!1;for(var g=0,p=t.length;g<p;g++)(o=t[g])[0]===n&&o[1]===r&&o[2]===i&&(l=!0);l||(c[u]=c[u+1]=c[u+2]=c[u+3]=0)}else c[u]=c[u+1]=c[u+2]=c[u+3]=0;else c[u]=c[u+1]=c[u+2]=c[u+3]=0}a._cx.putImageData(s,0,0),a.setDirty(!0)},this.getDataURL=function(){return a.canvas.toDataURL()},this._onBrushDown=function(e,t){a.setDirty(!0),a._isPaint=!0,a._cx.strokeStyle=a.getBrushColor();var n=a.constructor.getBrushPos(e,t),r=Object(Mt.a)(n,2),i=r[0],o=r[1],l=i+a.container.scrollLeft+a.dx,s=o+a.container.scrollTop+a.dy;a._cx.beginPath(),a._cx.moveTo(l,s),a._cx.lineTo(l+1,s+1),a._cx.closePath(),a._cx.stroke(),a._lastX=l,a._lastY=s+1},this._onBrushMove=function(e,t){if(a._isPaint){var n=a.constructor.getBrushPos(e,t),r=Object(Mt.a)(n,2),i=r[0],o=r[1],l=a.getBrushMode();"draw"===l?a._cx.globalCompositeOperation="source-over":"erase"===l&&(a._cx.globalCompositeOperation="destination-out");var s=i+a.container.scrollLeft+a.dx,c=o+a.container.scrollTop+a.dy;a._cx.beginPath(),a._cx.moveTo(a._lastX,a._lastY),a._cx.lineTo(s,c),a._cx.closePath(),a._cx.stroke(),a._lastX=s,a._lastY=c}},this._onBrushUp=function(){return a._isPaint=!1},this.canvas=n,this.container=r,this.dx=i,this.dy=o,this.setDirty=s,this.getBrushMode=c,this.getBrushColor=m,this._cx=this.canvas.getContext("2d"),this._isPaint=!1,this._lastX=null,this._lastY=null,l&&this._loadAndDrawImage(l),this._cx.imageSmoothingEnabled=!1,this._cx.lineJoin="round",this._cx.lineWidth=4,this._cx.globalCompositeOperation="source-over",this.canvas.addEventListener("mousedown",function(e){return a._onBrushDown(e)},!1),this.canvas.addEventListener("touchstart",function(e){return a._onBrushDown(e,!0)},!1),this.canvas.addEventListener("mousemove",function(e){return a._onBrushMove(e)},!1),this.canvas.addEventListener("touchmove",function(e){return a._onBrushMove(e,!0)},!1),this.canvas.addEventListener("mouseup",this._onBrushUp,!1),this.canvas.addEventListener("touchend",this._onBrushUp,!1)}return Object(m.a)(e,[{key:"_loadAndDrawImage",value:function(e){var t=this,a=new Image;a.crossOrigin="anonymous",a.onload=function(){t._cx.drawImage(a,0,0)},a.src=e}}]),e}();Ma.getBrushPos=function(e,t){return t?[e.touches[0].clientX,e.touches[0].clientY]:[e.clientX,e.clientY]};for(var Ua=a(336),za=E.withStyles(function(e){return{dialogTitle:{borderBottom:"1px solid ".concat(e.palette.divider),margin:0,padding:2*e.spacing.unit,paddingRight:55},closeButton:{position:"absolute",right:2,top:4,color:e.palette.grey[500]}}})(function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={label:a.props.label,rgb:a.props.rgb},a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props;return o.a.createElement(ce.a,{open:t.open,onClose:t.onClose},o.a.createElement(ie.a,{id:"add-segment-dialog",className:t.classes.dialogTitle},this.props.dialogTitle,o.a.createElement(z.a,{"aria-label":"Close",className:t.classes.closeButton,onClick:t.onClose},o.a.createElement(Ve.a,null,"close"))),o.a.createElement(le.a,null,o.a.createElement(Re.a,{id:"standard-name",label:"Name",value:this.state.label,onChange:function(t){return e.setState({label:t.target.value})},margin:"normal"}),o.a.createElement("br",null),o.a.createElement("br",null),"Color:",o.a.createElement("br",null),o.a.createElement(Ua.CompactPicker,{color:{r:this.state.rgb[0],g:this.state.rgb[1],b:this.state.rgb[2]},onChange:function(t){e.setState({rgb:[t.rgb.r,t.rgb.g,t.rgb.b]})},colors:Ha}),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement(Ht,{icon:"add",children:t.saveText,color:":pink",variant:"contained",fullWidth:!0,onClick:function(){return e.props.onSave(e.state)}})))}}]),t}(i.Component)),Ha=["#FF0000","#00FF00","#0000FF","#F44E3B","#FE9200","#FCDC00","#DBDF00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#008800","cyan","magenta","#D33115","#E27300","#FCC400","#B0BC00","#68BC00","#16A5A5","#009CE0","#7B64FF","#FA28FF","yellow","#000000","#FFFFFF","#9F0500","#C45100","#FB9E00","#808900","#194D33","#0C797D","#0062B1","#653294","#AB149E"],Wa=E.withStyles({})(function(e){return o.a.createElement(Me.a,Object.assign({id:"segment-menu",style:{top:e.segmentMenuTop,left:e.segmentMenuLeft}},v()(e).del("removeItem").del("editItem").del("selectedSegmentIdx").del("segmentMenuTop").del("segmentMenuLeft").value()),o.a.createElement(We.a,{className:e.classes.menuItem,onClick:function(){e.removeItem(e.selectedSegmentIdx),e.onClose()}},o.a.createElement(fe.a,{className:e.classes.icon},o.a.createElement(Ve.a,null,"close")),o.a.createElement(be.a,{classes:{primary:e.classes.primary},inset:!0,primary:"Remove Segment"})),o.a.createElement(We.a,{className:e.classes.menuItem,onClick:function(){e.editItem(e.selectedSegmentIdx),e.onClose()}},o.a.createElement(fe.a,{className:e.classes.icon},o.a.createElement(Ve.a,null,"edit")),o.a.createElement(be.a,{classes:{primary:e.classes.primary},inset:!0,primary:"Edit segment"})))}),Ga=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).state={imgW:null,imgH:null,imgLoaded:!1,activeSegmentIdx:1,segmentCtrlsDisabled:!1,segmentAnchorEl:null,selectedSegmentIdx:null,brushMode:"draw",addEditSegmentDialog:{open:!1,saveText:"",label:"",rgb:[0,0,255],onSave:null,segmentIdx:null}},a.drawerWidth=240,a.topBarHeight=64,a.handleClose=function(){a.painter&&(a.props.datasetimage.label_image._segmentation_data=a.painter.getDataURL()),a.props.onClose()},a.removeSegment=function(e){a.setState({segmentCtrlsDisabled:!0});var t=a.props.segments.map(function(e){return e.rgb}),n=t.splice(e,1)[0];a.props.removeSegment(e),a.painter.removePixels(n,t),a.props.segments.length>=2&&a.setActiveSegment(1),a.setState({segmentCtrlsDisabled:!1})},a.addSegment=function(){var e=Object(na.a)(aa.a.mark(function e(t){return aa.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.addSegment(t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.updateSegment=function(){var e=Object(na.a)(aa.a.mark(function e(t){return aa.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.updateSegment(t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.setActiveSegment=function(e){a.brushColor=a.rgb2hex(a.props.segments[e].rgb),a.setState({activeSegmentIdx:e})},a.imgRef=o.a.createRef(),a.canvasContainerRef=o.a.createRef(),a.brushColor=a.rgb2hex(a.props.segments[1].rgb),a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"initDrawing",value:function(e){var t=this;if(e&&!this.painter){this.props.datasetimage.label_image||(this.props.datasetimage.label_image={});var a=this.props.datasetimage.label_image._segmentation_data||this.props.datasetimage.label_image.image;this.painter=new Ma({canvas:e,container:this.canvasContainerRef.current,dx:-3-this.drawerWidth,dy:-2-this.topBarHeight,url:a,setDirty:function(e){return t.props.datasetimage._label_dirty=e},getBrushMode:function(){return t.state.brushMode},getBrushColor:function(){return t.brushColor}})}}},{key:"rgb2hex",value:function(e){return"#"+e.map(function(e){return("0"+e.toString(16)).slice(-2)}).join("")}},{key:"render",value:function(){var e=this,t=this.makeSidebar();return o.a.createElement(ce.a,{open:this.props.open,onClose:this.handleClose,fullScreen:!0},o.a.createElement(X.a,{position:"fixed",style:{zIndex:12345}},o.a.createElement(V.a,null,o.a.createElement("div",{style:{flexGrow:1}},this.props.datasetimage.id," -"," ",o.a.createElement("strong",null,this.props.datasetimage.image.summary.thumb.split("/").slice(-1)[0]),"\xa0\xa0\xa0\xa0\xa0\xa0",o.a.createElement(Fa.a.Group,null,o.a.createElement(Fa.a,{positive:"draw"===this.state.brushMode,onClick:function(){return e.setState({brushMode:"draw"})}},"Draw"),o.a.createElement(Fa.a.Or,null),o.a.createElement(Fa.a,{positive:"erase"===this.state.brushMode,onClick:function(){return e.setState({brushMode:"erase"})}},"Erase"))),o.a.createElement(z.a,{color:"inherit",onClick:this.handleClose,"aria-label":"Close"},o.a.createElement(Ve.a,null,"close")))),o.a.createElement("nav",{style:{width:this.drawerWidth,flexShrink:0}},o.a.createElement(k.a,{style:{width:this.drawerWidth},variant:"permanent",open:!0},o.a.createElement(t,null))),o.a.createElement("div",{style:{position:"fixed",top:64,left:this.drawerWidth,width:"calc(100% - ".concat(this.drawerWidth,"px)"),height:"calc(100% - 64px)",overflow:"scroll"},ref:this.canvasContainerRef},o.a.createElement("img",{style:{width:"auto",height:"auto",border:"4px solid purple"},src:this.props.datasetimage.image.image,alt:"",onLoad:function(){return e.setState({imgLoaded:!0,imgW:e.imgRef.current.naturalWidth,imgH:e.imgRef.current.naturalHeight})},ref:this.imgRef}),this.state.imgLoaded&&o.a.createElement("canvas",{width:this.state.imgW,height:this.state.imgH,ref:function(t){return e.initDrawing(t)},style:{position:"absolute",top:0,left:0,opacity:.5,border:"4px solid transparent",cursor:"crosshair"}})),o.a.createElement(za,Object.assign({},this.state.addEditSegmentDialog,{onClose:function(){return e.setState(function(e){return v.a.set(e,"addEditSegmentDialog.open",!1)})},key:this.state.addEditSegmentDialog.segmentIdx})))}},{key:"makeSidebar",value:function(){var e=this;return E.withStyles(function(e){return{toolbar:e.mixins.toolbar}})(function(t){return o.a.createElement("div",{style:{width:e.drawerWidth}},o.a.createElement("div",{className:t.classes.toolbar}),o.a.createElement(w.a,null),o.a.createElement(me.a,null,e.props.segments.slice(1).map(function(t,a){return o.a.createElement(ge.a,{button:!0,key:a,style:a+1===e.state.activeSegmentIdx?{background:zt(":blue.100")[0]}:{},onClick:function(){return e.setActiveSegment(a+1)}},o.a.createElement(fe.a,{style:{marginRight:0,color:e.rgb2hex(t.rgb)}},o.a.createElement(Ve.a,null,"palette")),o.a.createElement(be.a,{style:{marginRight:0}},t.label),o.a.createElement(Ht,{icon:"more_vert",size:"small",style:{marginRight:-20,minWidth:32},onClick:function(t){console.log("clicked segment opener:",t.currentTarget);var n=t.currentTarget.getBoundingClientRect();e.setState({segmentAnchorEl:t.currentTarget,segmentMenuTop:n.top,segmentMenuLeft:n.left,selectedSegmentIdx:a+1})}}))})),o.a.createElement(w.a,null),o.a.createElement(me.a,null,o.a.createElement(ge.a,null,o.a.createElement(x.a,{variant:"extended",size:"small",color:"secondary","aria-label":"Add",style:{marginLeft:35},onClick:function(){return e.setState({addEditSegmentDialog:{dialogTitle:"Add New Segment",open:!0,segmentIdx:e.props.segments.length,saveText:"Add",label:"",rgb:[0,0,255],onSave:function(t){e.props.addSegment({label:t.label,rgb:t.rgb}),e.setState(function(e){return v.a.set(e,"addEditSegmentDialog.open",!1)}),setTimeout(function(){return e.setActiveSegment(e.props.segments.length-1)},0)}}})}},o.a.createElement(Ve.a,null,"add"),"Add segment \xa0"))),o.a.createElement(Wa,{anchorEl:e.state.segmentAnchorEl,open:!!e.state.segmentAnchorEl,onClose:function(){return e.setState({segmentAnchorEl:null})},removeItem:e.removeSegment,editItem:function(t){return e.setState({addEditSegmentDialog:{dialogTitle:"Update Segment",open:!0,segmentIdx:t,saveText:"Update",label:e.props.segments[t].label,rgb:e.props.segments[t].rgb,onSave:function(a){e.props.updateSegment(t,a),e.setState(function(e){return v.a.set(e,"addEditSegmentDialog.open",!1)})}}})},selectedSegmentIdx:e.state.selectedSegmentIdx,segmentMenuTop:e.state.segmentMenuTop,segmentMenuLeft:e.state.segmentMenuLeft}))})}}]),t}(i.Component),Va=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={paintLabelsDialog:{open:!1,datasetImage:null}},a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return this.props.trainingDatasets.length?o.a.createElement(o.a.Fragment,null,this.props.trainingDatasets.map(function(t,a){return o.a.createElement(Pa,{key:"".concat(t.id,"-").concat(a),dataset:t,datasetIdx:a,updateTrainingDataset:function(t){return e.props.updateTrainingDataset(a,t)},imageActions:function(t){return o.a.createElement(Na,{children:"Add/Edit Segmentation Labels",variant:"contained",icon:"fa-paint-brush",color:":pink",onClick:function(){return e.setState({paintLabelsDialog:{open:!0,datasetImage:t.datasetimage}})}})}})}),this.state.paintLabelsDialog.open&&this.props.model&&this.props.trainingDatasets[0]&&o.a.createElement(Ga,{fullScreen:!0,open:this.state.paintLabelsDialog.open,onClose:function(){return e.setState({paintLabelsDialog:{open:!1,datasetImage:null}})},datasetimage:this.state.paintLabelsDialog.datasetImage,model:this.props.model,segments:this.props.model.labels,addSegment:this.props.addSegment,removeSegment:this.props.removeSegment,updateSegment:this.props.updateSegment})):null}}]),t}(i.Component),Za=[{id:0,imgThumbSrc:"/IHC S100 18EH20842__00.png",maskThumbSrc:"/IHC S100 18EH20842__00_S.png",imgSrc:"/IHC S100 18EH20842.png",maskSrc:"/IHC S100 18EH20842_S.png",score:"91.20%"},{id:1,imgThumbSrc:"/IHC S100 18EH20842__00.png",maskThumbSrc:"/IHC S100 18EH20842__00_S.png",imgSrc:"/IHC S100 18EH20842.png",maskSrc:"/IHC S100 18EH20842_S.png",score:"23.10%"}],Xa=0;Xa<2;Xa++)Za.push.apply(Za,Za);var qa=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={epochs:10,trainingInProgress:!1,trainingProgress:0},a.trainingSessionId=1,a.train=Object(na.a)(aa.a.mark(function e(){var t,n,r,i,o;return aa.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=10,a.setState({trainingInProgress:!0,trainingProgress:0}),a.trainingSessionId){e.next=13;break}if(!(n=oa.a.parse(a.props.location.search)).ts){e.next=8;break}a.trainingSessionId=+n.ts,e.next=13;break;case 8:return e.next=10,Ta.create({model_id:a.props.model.id,datasets:a.props.trainingDatasets.map(function(e){return e.id})});case 10:r=e.sent,a.trainingSessionId=r.data.id,window.history.replaceState({},"","?ts="+a.trainingSessionId);case 13:return i=new Promise(function(e,t){console.log("~ websocket connecting"),a._ws=new WebSocket(Aa()+"/train/model-".concat(a.props.model.id,"/ts-").concat(a.trainingSessionId,"/")),console.log("~ websocket created",a._ws),a._ws.onerror=function(e){console.log("~ ws error",e),t(e)},a._ws.onopen=function(t){console.log("~ ws open"),e(a._ws,t)}}),e.next=16,i;case 16:o=e.sent,console.log("~ websocket connected",o),o.send(JSON.stringify({type:"train",dataset_ids:[2],params:{epochs:10}})),o.onmessage=function(e){var n=JSON.parse(e.data);console.log("=== received websocket message:",n),"training_progress"===n.type&&a.setState({trainingInProgress:n.epoch!==t,trainingProgress:n.epoch/t*100})},o.onclose=function(e){a.setState({trainingInProgress:!1}),console.log("~ websocket closed",e)};case 21:case"end":return e.stop()}},e)})),a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentWillUnmount",value:function(){}},{key:"simulateTraining",value:function(){var e=this;this.setState({trainingInProgress:!0,trainingProgress:0}),setTimeout(function(){e.setState({trainingInProgress:!0,trainingProgress:60}),setTimeout(function(){return e.setState({trainingInProgress:!1,trainingProgress:100})},3e3)},1e3)}},{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(Ee.a,{square:!0},o.a.createElement(De.a,null,o.a.createElement("div",null,o.a.createElement("label",null,"Epochs: \xa0\xa0",o.a.createElement(Ia.a,{value:this.state.epochs,type:"number",onChange:function(t){return e.setState({epochs:+t.target.value})},style:{width:80}})),o.a.createElement(Ht,{children:"Train",color:":blue",variant:"contained",icon:"fa-cogs",style:{float:"right",width:124},loading:this.state.trainingInProgress,onClick:this.train})),this.state.trainingInProgress&&o.a.createElement(ke.a,{variant:"determinate",value:this.state.trainingProgress,style:{marginTop:16}}))),o.a.createElement("br",null),o.a.createElement(Ee.a,{square:!0,style:{border:"1px solid ".concat(nt.a[500])}},o.a.createElement(De.a,null,o.a.createElement("div",null,o.a.createElement("div",{style:{float:"right"}},o.a.createElement(Ht,{children:"Save",color:":green",textColor:"#fff",variant:"contained",icon:"save_alt",style:{width:100,marginBottom:16}}),o.a.createElement("br",null),o.a.createElement(Ht,{children:"Discard",textColor:":red",icon:"delete_outline",style:{width:100}})),o.a.createElement("p",null,o.a.createElement("code",null,"2019-02-03 18:42")),o.a.createElement("p",null,o.a.createElement("strong",null,"10 Epochs"),o.a.createElement("br",null),"Results - accurracy:"," ",o.a.createElement("strong",null,o.a.createElement("code",null,"83.12%"))),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("div",{style:{padding:16,background:"#f4f0fa"}},o.a.createElement(Xt,{items:Za}))))))}}]),t}(i.Component),Ya=[{key:"data",icon:"images",title:"Data",description:"Add/select training data",active:!0},{key:"labels",icon:"paint brush",title:"Labels",description:"Label training data"},{key:"training",icon:"cogs",title:"Training",description:"Train model with labeled data"}],Ja=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).state={DATA:{datasetsById:new Map,trainingDatasets:[],model:null},disableNav:!1},a.addTrainingDatasetImage=function(e,t){return a.setState(function(a){return v.a.push(a,"DATA.trainingDatasets.".concat(e,".datasetimages"),t)})},a.removeTrainingDatasetImage=function(e,t){return a.setState(function(a){return v.a.del(a,"DATA.trainingDatasets.".concat(e,".datasetimages.").concat(t))})},a.replaceTrainingDatasetImage=function(e,t,n){return a.setState(function(a){return v.a.set(a,"DATA.trainingDatasets.".concat(e,".datasetimages.").concat(t),n)})},a.updateTrainingDatasetImage=function(e,t,n){return a.setState(function(a){return v.a.merge(a,"DATA.trainingDatasets.".concat(e,".datasetimages.").concat(t),n)})},a.navToStep=function(e){var t=a.props,n=t.match,r=t.location;t.history.push("".concat(n.url,"/step-").concat(e+1,"-").concat(Ya[e].key).concat(r.search))},a.navToNextStep=Object(na.a)(aa.a.mark(function e(){var t,n;return aa.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.getActiveStepNo(a.props.location.pathname),n=Ya[t].key,a.setState({disableNav:!0}),e.prev=3,"data"!==n){e.next=9;break}return e.next=7,a.onNextFromStep1Data();case 7:e.next=12;break;case 9:if("labels"!==n){e.next=12;break}return e.next=12,a.onNextFromStep2Labels();case 12:a.navToStep(t+1),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),console.log("Dataset creation or image upload error:",e.t0);case 18:return e.prev=18,a.setState({disableNav:!1}),e.finish(18);case 21:case"end":return e.stop()}},e,null,[[3,15,18,21]])})),a.onNextFromStep1Data=Object(na.a)(aa.a.mark(function e(){return aa.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.createNewDatasets());case 1:case"end":return e.stop()}},e)})),a.onNextFromStep2Labels=Object(na.a)(aa.a.mark(function e(){return aa.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.updateModel();case 2:return e.next=4,a.saveLabels();case 4:case"end":return e.stop()}},e)})),a.markActiveStep=function(e,t){return e.map(function(e,a){return Object(c.a)({},e,{active:a===t})})},a.createNewDatasets=Object(na.a)(aa.a.mark(function e(){var t,n,r,i,o,l,s,u;return aa.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<a.state.DATA.trainingDatasets.length)){e.next=37;break}if(!(n=a.state.DATA.trainingDatasets[t]).id){e.next=5;break}return e.abrupt("continue",34);case 5:r=[],i=0;case 7:if(!(i<n.datasetimages.length)){e.next=28;break}if(!(o=n.datasetimages[i]).image_id){e.next=12;break}return r.push(o),e.abrupt("continue",25);case 12:return a.updateTrainingDatasetImage(t,i,{_status:"uploading"}),e.prev=13,e.next=16,a.createImage(o,i);case 16:l=e.sent,s={image_id:l.data.id,image:l.data,purpose:"validation",_status:"uploaded"},r.push(s),a.updateTrainingDatasetImage(t,i,s),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(13),a.updateTrainingDatasetImage(t,i,{_status:"upload failed",_error:e.t0});case 25:i++,e.next=7;break;case 28:if(r.length===n.datasetimages.length){e.next=30;break}throw Error("Some images could not be uploaded");case 30:return e.next=32,Ca.create({name:n.name,datasetimages:r.map(function(e){return{image_id:e.image_id,purpose:e.purpose}})});case 32:u=e.sent,2===Math.floor(u.status/100)&&a.updateTrainingDataset(t,Object(c.a)({},u.data,{datasetimages:r}));case 34:t++,e.next=1;break;case 37:case"end":return e.stop()}},e,null,[[13,22]])})),a.createImage=function(){var e=Object(na.a)(aa.a.mark(function e(t,a){var n,r,i;return aa.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._fileInput.current.files[0],r=n.name.match(/(.+)\.[^.]+$/),i=a+"-"+(r?r[1]:n.name),e.abrupt("return",ja.create({name:i,image:{file:n}}));case 4:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.updateModel=function(){return wa.update(a.state.DATA.model)},a.saveLabels=Object(na.a)(aa.a.mark(function e(){var t,n,r,i,o;return aa.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<a.state.DATA.trainingDatasets.length)){e.next=30;break}n=a.state.DATA.trainingDatasets[t],r=0;case 4:if(!(r<n.datasetimages.length)){e.next=27;break}if((i=n.datasetimages[r])._label_dirty){e.next=8;break}return e.abrupt("continue",24);case 8:if(i.label_image){e.next=10;break}throw Error("Error: image ".concat(r,' of dataset "').concat(i.name,'" is not labeled'));case 10:return e.prev=10,e.next=13,a.updateOrCreateLabelImage(i);case 13:if(o=e.sent,2===Math.floor(o.status/100)){e.next=16;break}throw Da(o);case 16:a.updateTrainingDatasetImage(t,r,{label_image_id:o.data.id,_label_save_status:"success",_label_dirty:!1}),i.label_image.id=o.data.id,e.next=24;break;case 20:e.prev=20,e.t0=e.catch(10),console.error("Error saving label:",e.t0),a.updateTrainingDatasetImage(t,r,{_label_save_status:"failed",_label_save_error:e.t0});case 24:r++,e.next=4;break;case 27:t++,e.next=1;break;case 30:case"end":return e.stop()}},e,null,[[10,20]])})),a.updateOrCreateLabelImage=function(e){var t=e.label_image._segmentation_data;return e.label_image.id?xa.update({id:e.label_image.id,image:{file_contents:t},dataset_image_id:e.id}):xa.create({image:{file_contents:t},models:[a.props.match.params.modelId],dataset_image_id:e.id})},ga(Object(ra.a)(Object(ra.a)(a)),"DATA.model.labels","Segment"),ga(Object(ra.a)(Object(ra.a)(a)),"DATA.trainingDatasets","TrainingDataset"),a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;wa.get(this.props.match.params.modelId).then(function(t){e.setState(function(e){return v.a.set(e,"DATA.model",wa.fromApiData(t.data))})}),Ca.list().then(function(t){var a=new Map(t.data.results.map(function(e){return[e.id,Ca.fromApiData(e)]}));e.setState(function(e){return v()(e).set("DATA.datasetsById",a).value()})})}},{key:"getActiveStepNo",value:function(e){var t=e.match(/\/train\/step-(\d+)/);return t?t[1]-1:-1}},{key:"render",value:function(){var e=this,t=this.props,a=t.match,n=t.location,r=+oa.a.parse(n.search).arch||null,i=this.getActiveStepNo(n.pathname);return o.a.createElement("div",{className:"ModelTraining"},o.a.createElement(R.a,{container:!0},o.a.createElement(R.a,{item:!0,xs:8},"Based on arcitecture ",o.a.createElement("code",null,r),"."),o.a.createElement(R.a,{item:!0,xs:4},o.a.createElement(W.a,{align:"right"},o.a.createElement(Qa,{onClick:function(){return e.navToStep(i-1)},disabled:this.state.disableNav||i<=0}),"\xa0\xa0\xa0",o.a.createElement($a,{onClick:this.navToNextStep,disabled:this.state.disableNav||i===Ya.length-1})))),o.a.createElement(la.a.Group,{items:this.markActiveStep(Ya,i),style:{width:"100%",borderRadius:0}}),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement(h.a,null,o.a.createElement(f.a,{exact:!0,path:a.path+"/step-1-data",render:function(t){return o.a.createElement(Ra,Object(c.a)({},t,{model:e.state.DATA.model,datasetsById:e.state.DATA.datasetsById,trainingDatasets:e.state.DATA.trainingDatasets,addTrainingDataset:e.addTrainingDataset,removeTrainingDataset:e.removeTrainingDataset,updateTrainingDataset:e.updateTrainingDataset,addTrainingDatasetImage:e.addTrainingDatasetImage,removeTrainingDatasetImage:e.removeTrainingDatasetImage}))}}),o.a.createElement(f.a,{exact:!0,path:a.path+"/step-2-labels",render:function(t){return o.a.createElement(Va,Object(c.a)({},t,{model:e.state.DATA.model,trainingDatasets:e.state.DATA.trainingDatasets,updateTrainingDataset:e.updateTrainingDataset,addSegment:e.addSegment,removeSegment:e.removeSegment,updateSegment:e.updateSegment}))}}),o.a.createElement(f.a,{exact:!0,path:a.path+"/step-3-training",render:function(t){return o.a.createElement(qa,Object(c.a)({},t,{model:e.state.DATA.model,trainingDatasets:e.state.DATA.trainingDatasets}))}})),o.a.createElement("br",null),o.a.createElement(R.a,{container:!0,spacing:16},o.a.createElement(R.a,{item:!0,xs:6},o.a.createElement(Qa,{onClick:function(){return e.navToStep(i-1)},disabled:this.state.disableNav||i<=0,fullWidth:!0,size:"large"})),o.a.createElement(R.a,{item:!0,xs:6},o.a.createElement($a,{onClick:this.navToNextStep,disabled:this.state.disableNav||i===Ya.length-1,fullWidth:!0,size:"large"}))))}}]),t}(i.Component),$a=function(e){return Ht(Object(c.a)({color:"primary",size:"small",variant:"contained",icon:"chevron_right",iconRight:!0,children:"Next"},e))},Qa=function(e){return Ht(Object(c.a)({size:"small",icon:"chevron_left",children:"Previous"},e))},Ka=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).createModelThenTrain=function(){var e=Object(na.a)(aa.a.mark(function e(t){var n;return aa.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wa.create(t);case 2:n=e.sent,a.props.setLastCreatedModel(n.data),a.props.history.push("/models/".concat(n.data.id,"/train"));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"Page"},o.a.createElement(Wt,null,o.a.createElement("pre",null,"[ create model ]"),o.a.createElement(Ht,{linkTo:"/models/1/train/step-1-data",variant:"contained",color:"primary"},"Create & train")))}}]),t}(i.Component),en=(a(754),function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={DATA:{user:null,lastCreatedModel:null}},a.setLastCreatedModel=function(e){return v.a.set(a.state,"DATA.modelData",e)},a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;Oa.getSelf().then(function(t){return e.setState({DATA:{user:t.data}})})}},{key:"render",value:function(){var e=this,t=this.props.classes;return this.state.DATA.user?o.a.createElement(o.a.Fragment,null,o.a.createElement(_.a,null),o.a.createElement("div",{className:"App"},o.a.createElement(X.a,{position:"static"},o.a.createElement(V.a,null,o.a.createElement(W.a,{variant:"h6",color:"inherit",className:t.grow},"HBot"),o.a.createElement(M.a,{color:"inherit"},"Logout"))),o.a.createElement("div",{className:"App-container"},o.a.createElement("div",null,o.a.createElement(f.a,{children:function(e){e.match;var t=e.history,a=e.location;return o.a.createElement(A.a,{value:"/"+a.pathname.split("/")[1],onChange:function(e,a){return t.push(a)}},o.a.createElement(N.a,{value:"/",label:"Dashboard"}),o.a.createElement(N.a,{value:"/models",label:"Models"}),o.a.createElement(N.a,{value:"/analyses",label:"Analyses"}))}}),o.a.createElement("br",null),o.a.createElement(h.a,null,o.a.createElement(f.a,{exact:!0,path:"/",component:Bt}),o.a.createElement(f.a,{exact:!0,path:"/models",component:Kt}),o.a.createElement(f.a,{path:"/models/new",render:function(t){return o.a.createElement(Ka,Object(c.a)({},t,{setLastCreatedModel:e.setLastCreatedModel}))}}),o.a.createElement(f.a,{path:"/models/:modelId/train",component:Ja}),o.a.createElement(f.a,{exact:!0,path:"/analyses",component:ea})))))):o.a.createElement("p",null,"Loading...")}}]),t}(i.Component)),tn=E.withStyles(function(e){return{root:{flexGrow:1,backgroundColor:e.palette.background.paper},paper:{padding:2*e.spacing.unit},grow:{flexGrow:1}}})(en);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var an=a(769),nn=a(338);a(755),a(756);window._=nn._,window._utils_=r,s.a.render(o.a.createElement(an.a,null,o.a.createElement(tn,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[396,1,2]]]);
//# sourceMappingURL=main.b5a2a1b7.chunk.js.map